---
#
#
# XXX Test af nyt affald tids opdeling: i dag, i går og x dage
#
platform: template
sensors:

  pap_affald:
    friendly_name: "Pap Affald"
    unique_id: pap_affald
    value_template: >-
      {% set days_until_collection = ((state_attr('calendar.pap','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') %}
      {% if days_until_collection == 0 %}
        Bliver hentet i dag
      {% elif days_until_collection == 1 %}
        Bliver hentet i morgen
      {% elif days_until_collection > 1 %}
        Bliver hentet om {{ days_until_collection }} dage
      {% else %}
        Dato ikke tilgængelig
      {% endif %}
    icon_template: >-
      {% if days_until_collection == 0 %}
        mdi:delete-empty
      {% else %}
        mdi:trash-can-outline
      {% endif %}
    attribute_templates:
      days_until_collection: >-
        {{ ((state_attr('calendar.pap','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') }}

  storskrald_affald:
    friendly_name: "Storskrald affald"
    unique_id: storskrald_affald
    value_template: >-
      {% set days_until_collection = ((state_attr('calendar.storskrald','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') %}
      {% if days_until_collection == 0 %}
        Bliver hentet i dag
      {% elif days_until_collection == 1 %}
        Bliver hentet i morgen
      {% elif days_until_collection > 1 %}
        Bliver hentet om {{ days_until_collection }} dage
      {% else %}
        Dato ikke tilgængelig
      {% endif %}
    icon_template: >-
      {% if days_until_collection == 0 %}
        mdi:delete-empty
      {% else %}
        mdi:trash-can-outline
      {% endif %}
    attribute_templates:
      days_until_collection: >-
        {{ ((state_attr('calendar.storskrald','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') }}

  papir_plast_mdk_affald:
    friendly_name: "Papir, plast og MDK affald"
    unique_id: papir_plast_mdk_affald
    value_template: >-
      {% set days_until_collection = ((state_attr('calendar.papir_plast_mdk','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') %}
      {% if days_until_collection == 0 %}
        Bliver hentet i dag
      {% elif days_until_collection == 1 %}
        Bliver hentet i morgen
      {% elif days_until_collection > 1 %}
        Bliver hentet om {{ days_until_collection }} dage
      {% else %}
        Dato ikke tilgængelig
      {% endif %}
    icon_template: >-
      {% if days_until_collection == 0 %}
        mdi:delete-empty
      {% else %}
        mdi:trash-can-outline
      {% endif %}
    attribute_templates:
      days_until_collection: >-
        {{ ((state_attr('calendar.papir_plast_mdk','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') }}

  metal_affald:
    friendly_name: "Metal og glas affald"
    unique_id: metal_og_glas_affald
    value_template: >-
      {% set days_until_collection = ((state_attr('calendar.metal_og_glas','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') %}
      {% if days_until_collection == 0 %}
        Bliver hentet i dag
      {% elif days_until_collection == 1 %}
        Bliver hentet i morgen
      {% elif days_until_collection > 1 %}
        Bliver hentet om {{ days_until_collection }} dage
      {% else %}
        Dato ikke tilgængelig
      {% endif %}
    icon_template: >-
      {% if days_until_collection == 0 %}
        mdi:delete-empty
      {% else %}
        mdi:trash-can-outline
      {% endif %}
    attribute_templates:
      days_until_collection: >-
        {{ ((state_attr('calendar.metal_og_glas','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') }}


#  mad_og_restaffald:
#    friendly_name: "Mad og restaffald"
#    unique_id: mad_og_restaffald
#    value_template: >-
#      {% set start_time = state_attr('calendar.mad_og_rest','start_time') %}
#      {% if start_time is none %}
#        Dato ikke tilgængelig
#      {% else %}
#        {% set days_until_collection = ((as_timestamp(start_time) - as_timestamp(now())) / 86400) | round(0) %}
#        {% if days_until_collection < 1 %}
#          Bliver hentet i dag
#        {% elif days_until_collection == 1 %}
#          Bliver hentet i morgen
#        {% else %}
#          Bliver hentet om {{ days_until_collection }} dage
#        {% endif %}
#      {% endif %}
#    icon_template: >-
#      {% if start_time is none %}
#        mdi:calendar-remove
#      {% else %}
#        {% if days_until_collection < 1 %}
#          mdi:delete-empty
#        {% else %}
#          mdi:trash-can-outline
#        {% endif %}
#      {% endif %}
#    attribute_templates:
#      days_until_collection: >-
#        {% if start_time is none %}
#          unknown
#        {% else %}
#          {{ ((as_timestamp(start_time) - as_timestamp(now())) / 86400) | round(0) }}
#        {% endif %}

#---
  mad_og_restaffald:
    friendly_name: "Mad og restaffald"
    unique_id: mad og restaffald
    value_template: >-
      {% set days_until_collection = ((state_attr('calendar.mad_og_rest','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') %}
      {% if days_until_collection == 0 %}
        Bliver hentet i dag
      {% elif days_until_collection == 1 %}
        Bliver hentet i morgen
      {% elif days_until_collection > 1 %}
        Bliver hentet om {{ days_until_collection }} dage
      {% else %}
        Dato ikke tilgængelig
      {% endif %}
    icon_template: >-
      {% if days_until_collection == 0 %}
        mdi:delete-empty
      {% else %}
        mdi:trash-can-outline
      {% endif %}
    attribute_templates:
      days_until_collection: >-
        {{ ((state_attr('calendar.mad_og_rest','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') }}
#---
  haveaffald:
    friendly_name: "Haveaffald"
    unique_id: haveaffald
    value_template: >-
      {% set days_until_collection = ((state_attr('calendar.haveaffald','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') %}
      {% if days_until_collection == 0 %}
        Bliver hentet i dag
      {% elif days_until_collection == 1 %}
        Bliver hentet i morgen
      {% elif days_until_collection > 1 %}
        Bliver hentet om {{ days_until_collection }} dage
      {% else %}
        Dato ikke tilgængelig
      {% endif %}
    icon_template: >-
      {% if days_until_collection == 0 %}
        mdi:delete-empty
      {% else %}
        mdi:trash-can-outline
      {% endif %}
    attribute_templates:
      days_until_collection: >-
        {{ ((state_attr('calendar.haveaffald','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') }}
  
  storskrald:
    friendly_name: "Storskrald"
    unique_id: storskrald
    value_template: >-
      {% set days_until_collection = ((state_attr('calendar.storskrald','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') %}
      {% if days_until_collection == 0 %}
        Bliver hentet i dag
      {% elif days_until_collection == 1 %}
        Bliver hentet i morgen
      {% elif days_until_collection > 1 %}
        Bliver hentet om {{ days_until_collection }} dage
      {% else %}
        Dato ikke tilgængelig
      {% endif %}
    icon_template: >-
      {% if days_until_collection == 0 %}
        mdi:delete-empty
      {% else %}
        mdi:trash-can-outline
      {% endif %}
    attribute_templates:
      days_until_collection: >-
        {{ ((state_attr('calendar.storskrald','start_time') | as_timestamp - now().timestamp()) / 86400) | round(0, 'ceil') }}