---
#
# https://community.home-assistant.io/t/solved-display-amount-of-online-offline-devices-within-group-xx-xx/209725/8
#
#
#
#platform: template
#sensors:
#  door_sensors_status_array:
#    value_template: >-
#      [{%- for e in state_attr('group.all_door_sensors', 'entity_id') %}
#        {% if loop.first %}{% else %},{% endif %}
#        {%- if states(e)|lower == 'on' %}1{% else %}0{% endif -%}
#      {%- endfor -%}]
#  door_sensors_status:
#    friendly_name: Dør Sensors åben
#    icon_template: 'mdi:door-open'
#    value_template: >-
#      {{ states('sensor.door_sensors_status_on') -}}/{{-  states('sensor.door_sensors_status_count') -}}

platform: template
sensors:
  door_sensors_status_array:
    friendly_name: "Door sensors status array"
    value_template: >-
      {% set members = state_attr('group.all_door_sensors', 'entity_id') or [] %}
      [
      {%- for e in members %}
        {%- if not loop.first %},{% endif -%}
        {{ 1 if is_state(e, 'on') else 0 }}
      {%- endfor -%}
      ]

  door_sensors_status_on:
    friendly_name: "Åbne døre (antal)"
    value_template: >-
      {% set members = state_attr('group.all_door_sensors', 'entity_id') or [] %}
      {{ expand(members) | selectattr('state', 'eq', 'on') | list | length }}

  door_sensors_status_count:
    friendly_name: "Døre i alt"
    value_template: >-
      {% set members = state_attr('group.all_door_sensors', 'entity_id') or [] %}
      {{ members | length }}

  door_sensors_status:
    friendly_name: "Dør sensorer åben"
    icon_template: "mdi:door-open"
    value_template: >-
      {{ states('sensor.door_sensors_status_on') }}/{{ states('sensor.door_sensors_status_count') }}
